# Руководство для QA-инженера: От нуля до героя API

Добро пожаловать! Это руководство поможет вам освоить тестирование API на примере этого проекта. Мы начнем с основ и постепенно перейдем к более сложным сценариям. Это безопасная среда для экспериментов, так что не бойтесь что-то сломать!

### 1. Что такое REST?

**REST** (Representational State Transfer) — это архитектурный стиль взаимодействия компонентов распределенного приложения в сети. Проще говоря, это набор правил о том, как системы должны общаться друг с другом.

Наша система подчиняется **правилам REST**, что означает:
- **Ресурсы**: Все (Авторы, Посты) является ресурсом, доступным по определенному URL.
- **Методы HTTP**: Используйте `GET` для чтения, `POST` для создания, `PUT`/`PATCH` для обновления и `DELETE` для удаления.
- **Stateless (без сохранения состояния)**: Каждый запрос от клиента содержит всю необходимую информацию для его обработки.

---

### 2. Первые шаги: Чтение данных

Давайте попробуем получить список всех авторов, а затем информацию о конкретном авторе.

<details>
<summary><b>Как делать запросы (Swagger, Postman, curl)</b></summary>

| Инструмент | Шаги |
| :--- | :--- |
| **Swagger** | Откройте `/api/docs/swagger/`, найдите нужный эндпоинт, нажмите **Try it out**, а затем **Execute**. Для защищенных эндпоинтов нажмите кнопку **Authorize** наверху и введите ваш токен в формате `Bearer <ваш_токен>`. |
| **Postman** | Создайте новый запрос, выберите метод (например, `GET`), введите URL (например, `http://127.0.0.1:8000/api/authors/`), нажмите **Send**. |
| **curl** | Выполните `curl -X GET http://127.0.0.1:8000/api/authors/` в терминале. |

</details>

**Упражнение:**
1. Получите список всех авторов.
2. Выберите один `id` из списка и получите детали этого автора (используя `/api/authors/{id}/`).
3. Сделайте то же самое для постов (`/api/posts/`).

---

### 3. Пагинация: Навигация по большим спискам

В реальных системах могут быть тысячи записей. Отправка их всех сразу была бы слишком медленной. **Пагинация** решает эту проблему, разделяя данные на "страницы".

В многих системах вы можете встретить `offset` и `limit`. Наша система использует **Page Number Pagination** (пагинацию по номеру страницы).
- `page`: Номер страницы, которую вы хотите увидеть.

**Параметры запроса (Query Parameters)** — это дополнения к URL, начинающиеся с `?`. Например: `/api/posts/?page=2`.

**Упражнение:** Попробуйте найти вторую и третью страницы списка постов.

<details>
<summary><b>Посмотреть ответ</b></summary>

**URL:** `http://127.0.0.1:8000/api/posts/?page=2` и `http://127.0.0.1:8000/api/posts/?page=3`

- **Swagger**: Введите `2` в поле `page` в разделе Parameters.
- **Postman**: На вкладке **Params** добавьте Key: `page`, Value: `2`.
- **curl**: `curl -X GET "http://127.0.0.1:8000/api/posts/?page=2"`

</details>

---

### 4. Сортировка и фильтрация

Бэкенды обычно позволяют уточнять результаты поиска.
- **Фильтрация**: Поиск конкретных записей (например, "только опубликованные посты").
- **Сортировка**: Упорядочивание записей (например, "сначала новые").

В нашем API:
- Фильтр постов по статусу: `?status=draft`, `?status=published` или `?status=archived`.
- Сортировка постов: `?ordering=created_at` (по возрастанию) или `?ordering=-created_at` (по убыванию).

**Упражнение:** Найдите все посты в статусе **черновик (draft)**. Затем найдите все **архивные (archived)** посты, отсортированные по дате создания (**created_at**) от новых к старым (по убыванию).

<details>
<summary><b>Посмотреть ответ</b></summary>

- **Черновики:** `http://127.0.0.1:8000/api/posts/?status=draft`
- **Архивные по убыванию даты:** `http://127.0.0.1:8000/api/posts/?status=archived&ordering=-created_at`

</details>

---

### 5. Аутентификация: Кто вы?

Большинство API требуют идентификации пользователя. Популярные методы:
- **Basic Auth**: Отправка логина и пароля с каждым запросом (менее безопасно).
- **API Keys**: Длинная секретная строка (ключ).
- **JWT (JSON Web Token)**: Наша система использует этот метод.

**Примечание:** Только аутентифицированные авторы могут создавать посты. Автор поста определяется автоматически на основе вашего токена аутентификации.

**Как работает JWT:**
1. Вы выполняете **Вход (Login)** со своими учетными данными.
2. Сервер возвращает вам токен доступа (`access` token).
3. Вы включаете этот токен в **Заголовок (Header)** каждого последующего запроса: `Authorization: Bearer <ваш_токен>`.

**Упражнение: Станьте автором**
1. **Регистрация:** Создайте себя как автора.
   - `POST /api/authors/`
   - Тело запроса (Body): `{"username": "tester", "password": "password123", "full_name": "QA Student"}`
2. **Вход (Login):** Получите свой токен.
   - `POST /api/login/`
   - Тело запроса (Body): `{"username": "tester", "password": "password123"}`
   - *Скопируйте полученный `access` токен.*
   - *В Swagger нажмите кнопку **Authorize** наверху и введите `Bearer <ваш_access_токен>`.*
3. **Опубликуйте пост:**
   - `POST /api/posts/`
   - Заголовок (Header): `Authorization: Bearer <ваш_токен>`
   - Тело запроса (Body): `{"title": "Мой первый пост", "content": "Привет, мир!", "status": "published"}`
4. **Отредактируйте свой пост:** Измените заголовок поста, используя `PATCH /api/posts/{id}/`.

---

### 6. Финальное задание: Расширенная фильтрация

Теперь, когда вы создали пост, попробуйте найти его в общем списке, используя фильтры.

**Упражнение:** Запросите список постов, отфильтровав их так, чтобы отображались только посты **вашего** автора (по ID).

<details>
<summary><b>Посмотреть ответ</b></summary>

**URL:** `http://127.0.0.1:8000/api/posts/?author={ваш_id_автора}`

Замените `{ваш_id_автора}` на ID, который вы получили при регистрации или нашли в списке авторов.

</details>

---

### 7. Заключение

Поздравляем! Вы освоили основы тестирования API. Теперь вы умеете:
- Работать с ресурсами REST.
- Использовать пагинацию, фильтрацию и сортировку.
- Работать с аутентификацией JWT.
- Выполнять CRUD операции.

Продолжайте практиковаться и изучайте документацию Swagger для получения более подробной информации!

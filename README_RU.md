# Практика QA: Проект API Авторов и Постов

Это REST API на базе Django, разработанное специально для инженеров по тестированию (QA) для практики и совершенствования навыков тестирования. Оно предоставляет реалистичную среду для тестирования конечных точек (endpoints) API с использованием таких инструментов, как Postman, curl и Swagger/OpenAPI.

[English version of README](README.md)

[Туториал для QA-инженера](QA_GUIDE_RU.md) — **Откройте его, как только все будет установлено!**

Основные функции для тестирования:
- **Аутентификация**: Поток аутентификации на основе JWT.
- **Операции CRUD**: Действия по созданию, чтению, обновлению и удалению для Авторов и Постов.
- **Фильтрация и сортировка**: Расширенные запросы в конечной точке Постов.
- **Документация**: Интегрированные Swagger и Redoc для исследования API.

## Установка и запуск

Выполните следующие шаги для локальной настройки проекта на любой операционной системе (Windows, macOS или Linux).

### 1. Требования
- Должен быть установлен **Python 3.8+**.
- **pip** (установщик пакетов Python).

### 2. Настройка виртуального окружения (рекомендуется)
Создание виртуального окружения изолирует зависимости проекта.

**В Windows:**
```powershell
python -m venv venv
.\venv\Scripts\activate
```

**В macOS/Linux:**
```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка зависимостей
Активировав виртуальное окружение, установите необходимые пакеты:
```bash
pip install django djangorestframework djangorestframework-simplejwt drf-spectacular django-filter pytest-django
```

### 4. Запуск миграций
Настройте локальную базу данных SQLite:
```bash
python manage.py migrate
```

### 5. Сбор статических файлов
Соберите статические файлы в директорию `staticfiles`:
```bash
python manage.py collectstatic --noinput
```

### 6. Предварительное заполнение базы данных (опционально)
Если вы хотите начать с некоторых примеров данных (10 авторов и 142 поста):
```bash
python manage.py loaddata dummy_data.json
```
**Предупреждение:** Эта команда перезапишет существующие данные в базе данных, если объекты (например, авторы или посты) имеют те же ID, что и в фикстуре.

### 7. Создание суперпользователя (опционально)
Если вы хотите получить доступ к интерфейсу администратора Django по адресу `/admin/` для управления данными через UI:
```bash
python manage.py createsuperuser
```

### 8. Запуск сервера разработки
Запустите сервер API:
```bash
python manage.py runserver
```
API будет доступно по адресу `http://127.0.0.1:8000/`.

## Аутентификация

Аутентификация для авторов осуществляется через JWT (JSON Web Tokens). Это отделено от встроенной аутентификации пользователей Django.

### Через Curl

1. **Регистрация/Создание автора:**
   ```bash
   curl -X POST http://127.0.0.1:8000/api/authors/ \
        -H "Content-Type: application/json" \
        -d '{"username": "myuser", "password": "mypassword", "full_name": "My Name"}'
   ```

2. **Получение JWT токена:**
   ```bash
   curl -X POST http://127.0.0.1:8000/api/login/ \
        -H "Content-Type: application/json" \
        -d '{"username": "myuser", "password": "mypassword"}'
   ```
   Это вернет токены `access` и `refresh`.

3. **Выполнение аутентифицированных запросов:**
   Включите access токен в заголовок `Authorization`:
   ```bash
   curl -X GET http://127.0.0.1:8000/api/posts/ \
        -H "Authorization: Bearer <ваш_access_токен>"
   ```

### Через Postman

1. **Получение токена:**
   - Создайте `POST` запрос к `http://127.0.0.1:8000/api/login/`.
   - На вкладке **Body** выберите `raw` и `JSON`.
   - Укажите ваши `username` и `password`.
   - Отправьте запрос и скопируйте токен `access` из ответа.

2. **Аутентифицированный запрос:**
   - Создайте новый запрос (например, `POST` к `http://127.0.0.1:8000/api/posts/`).
   - На вкладке **Authorization** выберите **Auth Type**: `Bearer Token`.
   - Вставьте токен `access` в поле **Token**.
   - Отправьте запрос.

### Аутентификация в Swagger

1. Перейдите по адресу `http://127.0.0.1:8000/api/docs/swagger/`.
2. Найдите эндпоинт `/api/login/` и нажмите **Try it out**.
3. Введите свои учетные данные и нажмите **Execute**.
4. Скопируйте токен `access`.
5. Нажмите кнопку **Authorize** в верхней части страницы.
6. Введите `Bearer <ваш_access_токен>` (или просто токен, в зависимости от конфигурации, но обычно `Bearer <токен>`) в поле значения.
7. Нажмите **Authorize**, а затем **Close**. Теперь последующие запросы, сделанные через Swagger, будут аутентифицированы.

## Документация API и эндпоинты

- **Swagger UI:** [http://127.0.0.1:8000/api/docs/swagger/](http://127.0.0.1:8000/api/docs/swagger/)
- **Redoc:** [http://127.0.0.1:8000/api/docs/redoc/](http://127.0.0.1:8000/api/docs/redoc/)
- **OpenAPI Schema (JSON):** [http://127.0.0.1:8000/api/schema/](http://127.0.0.1:8000/api/schema/)

### Основные эндпоинты:

- `POST /api/authors/` - Регистрация нового автора (Публичный)
- `GET /api/authors/` - Список авторов (Публичный)
- `GET /api/authors/{id}/` - Получение информации об авторе (Публичный)
- `PATCH/PUT /api/authors/{id}/` - Обновление профиля (Аутентифицированный, только владелец)
- `DELETE /api/authors/{id}/` - Удаление профиля (Аутентифицированный, только владелец)
- `POST /api/login/` - Получение JWT токенов (Публичный)
- `GET /api/posts/` - Список постов (Публичный, поддерживает фильтрацию по `status` и `author`, и сортировку по `created_at`, `updated_at`)
- `POST /api/posts/` - Создание поста (Аутентифицированный)
- `GET /api/posts/{id}/` - Получение информации о посте (Публичный)
- `PATCH/PUT /api/posts/{id}/` - Обновление поста (Аутентифицированный, только владелец)
- `DELETE /api/posts/{id}/` - Удаление поста (Аутентифицированный, только владелец)

## Запуск тестов

Запустите тесты с помощью pytest:
```bash
pytest
```
